#!/usr/bin/env python3
import matplotlib.pyplot as plt
import pandas as pd
import sys

def main():
    if len(sys.argv) > 1:
        if sys.argv[1] == "-":
            file = sys.stdin
        else:
            file = sys.argv[1]
    else:
        file = "~/.local/share/weight/weight.csv"
    df = pd.read_csv(file)
    df["date"] = pd.to_datetime(df["date"])
    df.set_index("date", drop=True, inplace=True)
    
    weight = df["weight"]
    average = weight.rolling(window=7).mean()

    fig, ax = plt.subplots(figsize=(12,8))
    plt.plot(weight, marker=".", label="Weight", color="tab:blue",
            linestyle="dashdot")
    plt.plot(average, color="tab:red", label="7 Day average",
             marker="o")
    # Adds the weight as label to the point.
    # Excluding the first 6 point as they don't have an average
    for k,v in zip(average.index[6:],average[6:]):
        ax.text(k,v,f"{v:.1f}",size=8,color="r")

    plt.ylabel("Weight(kgs)")
    plt.xlabel("Date")
    plt.xticks(rotation="vertical")
    plt.grid()
    plt.legend()

    plt.show()

if __name__ == "__main__":
    main()
